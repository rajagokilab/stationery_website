{% extends "base.html" %}
{% load static %}

{% block title %}Track Order{% endblock %}

{% block content %}
<div class="container py-5 px-3">
    <h1 class="my-5 text-center">Track Your Order</h1>

    <div class="bg-white rounded-4 shadow-sm p-4 p-md-5 mb-5">

        <!-- Order Info -->
        <div class="card mb-4 border-0">
            {% if items.0.product.image %}
                <img src="{{ items.0.product.image.url }}" class="card-img-top rounded-4" alt="Order Banner">
            {% else %}
                <img src="https://placehold.co/1000x200/F0F0F0/FFFFFF?text=Order+Banner" class="card-img-top rounded-4" alt="Order Banner">
            {% endif %}
            <div class="card-body px-0">
                <p class="card-text">
                    <small class="text-muted">Order ID :</small> <span class="fw-bold">OD{{ order.id }}</span><br>
                    <small class="text-muted">Customer :</small> <span class="fw-bold">{{ order.user.username }}</span><br>
                    <small class="text-muted">Payment Mode :</small> <span class="fw-bold">{{ order.get_payment_mode_display }}</span><br>
                    <small class="text-muted">Total Amount :</small> <span class="fw-bold">Rs. {{ order.total_amount }}</span><br>
                    <small class="text-muted">Placed On :</small> <span class="fw-bold">{{ order.created_at|date:"M d, Y" }}</span>
                </p>
            </div>
        </div>

    <!-- Order Tracking Timeline -->
<ul class="list-unstyled position-relative ms-4 mb-5">
    <!-- Step 1: Order Confirmed -->
    <li class="position-relative mb-4">
        {% if tracking_status in 'confirmed shipped out_for_delivery delivered' %}
        <div class="position-absolute top-0 start-0 translate-middle bg-success rounded-circle d-flex justify-content-center align-items-center" style="width: 20px; height: 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.098 5.46-6.494z"/>
            </svg>
        </div>
        {% else %}
        <div class="position-absolute top-0 start-0 translate-middle border border-secondary rounded-circle" style="width: 20px; height: 20px;"></div>
        {% endif %}
        <strong class="timeline-text">Order Confirmed, {{ order.created_at|date:"M d" }}</strong>
    </li>

    <!-- Step 2: Shipped -->
    <li class="position-relative mb-4">
        {% if tracking_status in 'shipped out_for_delivery delivered' %}
        <div class="position-absolute top-0 start-0 translate-middle bg-success rounded-circle d-flex justify-content-center align-items-center" style="width: 20px; height: 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.098 5.46-6.494z"/>
            </svg>
        </div>
        {% else %}
        <div class="position-absolute top-0 start-0 translate-middle border border-secondary rounded-circle" style="width: 20px; height: 20px;"></div>
        {% endif %}
        <strong  class="timeline-text">Shipped</strong>
    </li>

    <!-- Step 3: Out for Delivery -->
    <li class="position-relative mb-4">
        {% if tracking_status in 'out_for_delivery delivered' %}
        <div class="position-absolute top-0 start-0 translate-middle bg-success rounded-circle d-flex justify-content-center align-items-center" style="width: 20px; height: 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.098 5.46-6.494z"/>
            </svg>
        </div>
        {% else %}
        <div class="position-absolute top-0 start-0 translate-middle border border-secondary rounded-circle" style="width: 20px; height: 20px;"></div>
        {% endif %}
        <strong  class="timeline-text">Out for Delivery</strong>
    </li>

    <!-- Step 4: Delivered -->
    <li class="position-relative mb-4">
        {% if tracking_status == 'delivered' %}
        <div class="position-absolute top-0 start-0 translate-middle bg-success rounded-circle d-flex justify-content-center align-items-center" style="width: 20px; height: 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.098 5.46-6.494z"/>
            </svg>
        </div>
        {% else %}
        <div class="position-absolute top-0 start-0 translate-middle border border-secondary rounded-circle" style="width: 20px; height: 20px;"></div>
        {% endif %}
        <strong  class="timeline-text">Delivery, {{ delivery_date|date:"M d" }} by 11 PM</strong>
    </li>
</ul>

<!-- Connecting Line -->
<style>
    .timeline-text {
    margin-left: 20px; /* shifts text to the right */
    display: inline-block; /* ensures margin works properly */
}
ul.list-unstyled.position-relative.ms-4::before {
    content: "";
    position: absolute;
    top: 5px;
    left: -2px; /* aligns with circle center */
    width: 3px;
    height: 100%;
    background-color: #28a745; /* green line */
}
</style>

        <!-- Order Items Summary -->
        <div class="card p-4 rounded-4 shadow-sm">
            <h2 class="h4 mb-4">Order Details</h2>
            <table class="table table-borderless">
                <thead>
                    <tr>
                        <th scope="col" class="fw-bold">Product</th>
                        <th scope="col" class="text-center fw-bold">Quantity</th>
                        <th scope="col" class="text-center fw-bold">Unit Price</th>
                        <th scope="col" class="text-end fw-bold">Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                {% if item.product.image %}
                                    <img src="{{ item.product.image.url }}" class="me-3 rounded-2" alt="{{ item.product.name }}" style="max-width: 60px;">
                                {% else %}
                                    <img src="https://placehold.co/100x100/E0E0E0/FFFFFF?text=No+Image" class="me-3 rounded-2" alt="No image" style="max-width: 60px;">
                                {% endif %}
                                <div>
                                    <p class="mb-0 fw-bold">{{ item.product.name }}</p>
                                    <p class="mb-0 text-muted">Rs. {{ item.price }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="align-middle text-center">{{ item.quantity }}</td>
                        <td class="align-middle text-center">Rs. {{ item.price }}</td>
                        <td class="align-middle text-end">Rs. {{ item.get_total_price }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Total Amount -->
            <div class="bg-primary text-white p-3 rounded-3 d-flex justify-content-between align-items-center mt-3">
                <h4 class="h5 mb-0">Total</h4>
                <h4 class="h5 mb-0">Rs. {{ order.total_amount }}</h4>
            </div>

            <!-- Payment Method -->
            <div class="d-flex align-items-center mt-3 justify-content-center">
                <div class="form-check me-2">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="cod" {% if order.payment_mode == 'cod' %}checked{% endif %}>
                </div>
                <small class="text-muted">{{ order.get_payment_mode_display }}</small>
            </div>
        </div>

    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
